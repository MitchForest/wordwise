# Epic 1: Local-First Analysis Refactor

**Description:** This epic covers the full architectural refactor of the analysis engine to a more responsive, event-driven model. The goal is to improve application performance and user experience by moving from a single, slow analysis to a multi-event system that provides targeted feedback with appropriate urgency.

---

### Feature Sprints

1.  **Sprint 001: Foundation & Cleanup:** (✅ Completed) Established the new architectural foundation, including the unified context, hook, and engine skeletons.
2.  **Sprint 002: Local Spelling Implementation:** (✅ Completed) Implemented initial client-side spell checking.
3.  **Sprint 003: Local Style & Basic Grammar:** (✅ Completed) Integrated basic grammar and style suggestions using `write-good`.
4.  **Sprint 004: UI Polish & Document Metrics:** (✅ Completed) Refined the UI, re-implemented the status bar, and added document-level metrics.
5.  **Sprint 005: Multi-Tiered Analysis & UI Stability:** (✅ Completed) Re-architected the system to use a multi-event model, introduced a "Reconciliation Window" to solve UI race conditions, implemented "Context-Aware IDs" to fix key collisions, and decoupled word count for a live, client-side experience.
6.  **Sprint 006: WordPress Publishing MVP:** (Next Up) Integrate with the WordPress REST API to allow users to directly publish or update posts from within the WordWise editor.

---

### Architectural Summary & Key Decisions

*   **Event-Driven Model:** The final architecture is not "local-first" but an **event-driven model** with four distinct analysis events (Live Client Metrics, Real-time Spell Check, Fast Analysis Bundle, Deep Analysis Bundle). This provides a highly responsive UX.
*   **State Management:** All UI state is managed through the `SuggestionContext`. A **Reconciliation Window** was implemented to handle asynchronous server updates gracefully and prevent UI instability.
*   **Suggestion Identity:** Suggestion IDs are now **Context-Aware**, generated by hashing the `ruleId`, `originalText`, and a `contextSnippet`. This is a critical feature that prevents React key collisions for repeating errors.
*   **Performance:** Word count is calculated instantly on the client for a "live" feel, while heavier analysis (SEO, Readability) is handled by a debounced server call. 